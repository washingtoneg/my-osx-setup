---
# gcalcli-related tasks file for darwin_bootstrap

- name: Set up gcalcli
  shell: >
    python setup.py install
  args:
    chdir: "$scratch/gcalcli"
  ignore_errors: true

- name: Symlink gcalcli
  file:
    src: "$scratch/gcalcli/gcalcli/cli.py"
    dest: /usr/local/bin/gcalcli
    force: yes
    state: link

- name: Create next event file for gcalcli
  cron:
    name: "Create next event file for gcalcli"
    minute: "*"
    job: "/usr/local/bin/gcalcli --calendar={{ SSH_KEY_EMAIL }} agenda --nostarted | sed -ne 2p | tr -d '[[:cntrl:]]' | sed 's/0m0;36m//g' | tr -s ' ' > {{ USER }}/.gcalcli_next_event"
