#!/usr/bin/env python3

import json, os, subprocess, platform

# Set the appropriate Python interpreter for localhost
# Detect architecture and use correct Homebrew path
machine = platform.machine()
homebrew_python = '/opt/homebrew/bin/python3' if machine == 'arm64' else '/usr/local/bin/python3' 

# Use Homebrew Python if it exists (after Homebrew is installed)
# Otherwise use auto_silent to let Ansible find the best available Python
if os.path.exists(homebrew_python):
    python_interpreter = homebrew_python
else:
    python_interpreter = 'auto_silent'

def get_sshconfig():
    hosts = { '_meta': { 'hostvars': {} } }

    localhost = {
        'hosts': ['localhost'],
        'vars': { 'ansible_connection': 'local'}
    }

    hosts['my-computer'] = localhost

    hosts['_meta']['hostvars']['localhost'] = { 'ansible_python_interpreter': python_interpreter }

    return hosts

print(json.dumps(get_sshconfig()));
